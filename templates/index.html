<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/agents.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Add KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <!-- Add Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <!-- Add KaTeX for LaTeX rendering -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/list@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/table@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/quote@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/code@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/image@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/embed@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/delimiter@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/raw@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/checklist@latest"></script>
    <!-- New EditorJS plugins -->
    <script src="https://cdn.jsdelivr.net/npm/editorjs-paragraph-with-alignment@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@calumk/editorjs-columns@latest"></script>
    <!-- Additional EditorJS tools -->
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/marker@latest"></script>
    <script src="https://unpkg.com/editorjs-annotation@latest/dist/bundle.js"></script>
    <script src="https://unpkg.com/editorjs-undo@latest/dist/bundle.js"></script>
    <!-- End new plugins -->
    <script src="https://cdn.jsdelivr.net/npm/editorjs-drag-drop"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Add jsPDF for direct PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>
    
    <!-- Floating toggle button for when mobile header is collapsed -->
    <button class="mobile-header-toggle" id="mobileHeaderToggle" title="Show mobile header">
        <i class="fas fa-chevron-down"></i>
    </button>
    
    <!-- Floating toggle button for when desktop tabs are collapsed -->
    <button class="desktop-tabs-toggle" id="desktopTabsToggle" title="Show tabs">
        <i class="fas fa-chevron-down"></i>
    </button>
    
    <div class="container">
        <!-- Mobile Header with Tabs -->
        <div class="mobile-header">
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <!-- Mobile Tab Navigation -->
            <div class="mobile-tab-nav">
                <div class="tabs-container">
                    <div id="mobileTabsWrapper">
                        <div id="mobileTabsList">
                            <!-- Mobile tabs will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="mobile-tabs-toggle" id="mobileTabsToggle" title="Toggle tabs">
                <i class="fas fa-chevron-up"></i>
            </button>
        </div>
        
        <div class="sidebar" id="sidebar">
            <!-- Sidebar buttons for Notes -->
            <div id="notesButtons" class="sidebar-icons">
                <button id="createFolder" class="btn-icon" title="Create Folder"><i class="fas fa-folder-plus"></i></button>
                <button id="createNote" class="btn-icon" title="Create Note"><i class="fas fa-file-alt"></i></button>
                <!-- OCR or other note buttons can be appended here -->
            </div>
            <!-- Sidebar buttons for Chat (initially hidden) -->
            <div id="chatButtons" class="sidebar-icons is-hidden">
                <button id="createFolderChat" class="btn-icon" title="Create Folder"><i class="fas fa-folder-plus"></i></button>
                <button id="createChat" class="btn-icon" title="Create Chat"><i class="fas fa-comments"></i></button>
            </div>
            <!-- Sidebar buttons for Flashcards (initially hidden) -->
            <div id="flashcardsButtons" class="sidebar-icons is-hidden">
                <button id="createFolderFlashcards" class="btn-icon" title="Create Folder"><i class="fas fa-folder-plus"></i></button>
                <button id="createFlashcard" class="btn-icon" title="Create Flashcards"><i class="fas fa-layer-group"></i></button>
            </div>
            <!-- Sidebar buttons for Agents (initially hidden) -->
            <div id="agentsButtons" class="sidebar-icons is-hidden">
                <button id="createAgent" class="btn-icon" title="Create Agent"><i class="fas fa-robot"></i></button>
            </div>
            <!-- Create Form (shared) -->
            <div class="create-form is-hidden" id="createForm">
                <input type="text" id="createNameInput" placeholder="Enter name...">
                <div class="create-buttons">
                    <button id="confirmCreate"><i class="fas fa-check"></i></button>
                    <button id="cancelCreate"><i class="fas fa-times"></i></button>
                </div>
                <input type="hidden" id="createType" value="">
            </div>
            <!-- Tree containers: one for notes, one for chats, and one for flashcards -->
            <div id="noteTreeContainer" class="tree-container">
                <ul id="note-tree" class="tree">
                    <!-- Tree nodes for notes will be added here dynamically -->
                </ul>
            </div>
            <div id="chatTreeContainer" class="tree-container is-hidden">
                <ul id="chat-tree" class="tree">
                    <!-- Tree nodes for chats will be added here dynamically -->
                </ul>
            </div>
            <div id="flashcardsTreeContainer" class="tree-container is-hidden">
                <ul id="flashcards-tree" class="tree">
                    <!-- Tree nodes for flashcards will be added here dynamically -->
                </ul>
            </div>
            <div id="agentsTreeContainer" class="tree-container is-hidden">
                <ul id="agents-tree" class="tree">
                    <!-- Agents will be listed here dynamically -->
                </ul>
            </div>
        </div>
        <div class="content">
            <!-- Add dynamic tab navigation -->
            <div class="dynamic-tabs">
                <div class="tabs-container">
                    <!-- Desktop sidebar toggle button moved here -->
                    <button class="desktop-sidebar-toggle btn-icon" id="desktopSidebarToggle" title="Toggle Sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div id="tabsWrapper">
                        <div id="tabsList">
                            <!-- Tabs will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Original tab navigation remains but will be hidden or shown based on active dynamic tab -->
            <div class="tab-nav">
                <button id="notesTabBtn" class="tab-btn active">Notes</button>
                <button id="chatTabBtn" class="tab-btn">Chat</button>
                <button id="flashcardsTabBtn" class="tab-btn">Flashcards</button>
                <button id="agentsTabBtn" class="tab-btn">Agents</button>
            </div>
            
            <!-- Notes Section -->
            <div id="notesSection">
                <div class="note-header">
                    <div class="note-header-main">
                        <h2 id="note-title-display">Select a note</h2>
                        <div id="noteTagsInline" class="note-tags-inline"></div>
                    </div>
                    <div class="note-actions">
                        <div class="note-tags-button" id="noteTagsButton" title="Manage tags">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div id="noteTagsMenu" class="note-tags-menu is-hidden"></div>
                        <div class="export-pdf" id="exportPdf" title="Export as PDF">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="note-customizer" id="noteCustomizer" title="Edit background">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                    </div>
                </div>
                <div id="editorjs"></div>
            </div>
            <!-- Chat Section (initially hidden) -->
            <div id="chatSection" class="is-hidden">
                <div class="chat-container">
                    <!-- Model selector dropdown in fixed position -->
                    <div class="model-selector-container chat-header-model">
                        <button id="modelSelectorBtn" class="input-btn model-btn" title="Select AI Model">
                            <i class="fas fa-robot"></i>
                            <span id="selectedModelName">llama3.2:1b</span>
                            <i class="fas fa-chevron-up"></i>
                        </button>
                        <div id="modelDropdown" class="model-dropdown">
                            <div class="dropdown-header">Available Models</div>
                            <div id="modelList" class="model-list">
                                <div class="loading-models">Loading models...</div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <!-- Chat messages will appear here -->
                    </div>
                    <div class="chat-input-area">
                        <div class="chat-input-wrapper">
                            <div class="input-buttons-left">
                                <button id="chatPlusBtn" class="input-btn" title="More options">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <div id="chatPlusMenu" class="chat-plus-menu">
                                    <div class="chat-plus-menu-content"><!-- upload/voice buttons injected here --></div>
                                </div>
                            </div>
                            <textarea id="chatInput" placeholder="Type your message..." rows="1"></textarea>
                            <div class="input-buttons-right">
                                <button id="chatRecordBtn" class="input-btn" title="Record audio">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button id="chatSendBtn" class="input-btn send-btn" title="Send message">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        <!-- Hidden voice chat button for modal functionality -->
                        <button id="voiceChatBtn" class="is-hidden" title="Start voice conversation">
                            <i class="fas fa-comment-dots"></i>
                        </button>
                    </div>
                </div>
            </div>
            <!-- Flashcards Section (initially hidden) -->
            <div id="flashcardsSection" class="is-hidden">
                <h2>Flashcards</h2>
                <div id="flashcardsContent">
                    <!-- Dynamic flashcards content -->
                </div>
            </div>
            <!-- Agents Section (initially hidden) -->
            <div id="agentsSection" class="is-hidden"></div>
        </div>
    </div>
    
    <!-- Gooey Menu for New Tab - Moved outside content for proper z-index -->
    <nav class="gooey-menu">
        <input type="checkbox" href="#" class="menu-open" name="menu-open" id="menu-open"/>
        <label class="menu-open-button" for="menu-open" title="Create new tab">
            <i class="fas fa-plus plus-icon"></i>
        </label>
        
        <a href="#" class="menu-item" data-type="note" title="Create Note Tab"> 
            <i class="fas fa-file-alt"></i> 
        </a>
        <a href="#" class="menu-item" data-type="chat" title="Create Chat Tab"> 
            <i class="fas fa-comments"></i> 
        </a>
        <a href="#" class="menu-item" data-type="flashcards" title="Create Flashcards Tab"> 
            <i class="fas fa-layer-group"></i> 
        </a>
        <a href="#" class="menu-item" data-type="agents" title="Create Agents Tab"> 
            <i class="fas fa-robot"></i> 
        </a>
    </nav>
    
    <!-- SVG filters for gooey effect -->
    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="position: absolute; width: 0; height: 0;">
        <defs>
            <filter id="shadowed-goo">
                <feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="10" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo" />
                <feGaussianBlur in="goo" stdDeviation="3" result="shadow" />
                <feColorMatrix in="shadow" mode="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 -0.2" result="shadow" />
                <feOffset in="shadow" dx="1" dy="1" result="shadow" />
                <feComposite in2="shadow" in="goo" result="goo" />
                <feComposite in2="goo" in="SourceGraphic" result="mix" />
            </filter>
            <filter id="goo">
                <feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="10" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo" />
                <feComposite in2="goo" in="SourceGraphic" result="mix" />
            </filter>
        </defs>
    </svg>
    
    <script src="/static/js/TreeView.js"></script>
    <script src="/static/js/dragDrop.js"></script>
    <script src="/static/js/templateManager.js"></script>
    <!-- Minimal Markdown -> EditorJS converter -->
    <script src="/static/js/markdown.js"></script>
    <script src="/static/js/editor.js"></script>
    <script src="/static/js/debug.js"></script>
    <!-- Added modal.js so that ModalManager is available -->
    <script src="/static/js/modal.js"></script>
    <!-- Add notifications utility -->
    <script src="/static/js/notifications.js"></script>
    <!-- Add toggle manager for unified toggle functionality -->
    <script src="/static/js/toggleManager.js"></script>
    <!-- Add mobile responsiveness -->
    <script src="/static/js/mobile.js"></script>
    <!-- Sources Sidebar -->
    <div id="sourcesSidebar" class="sources-sidebar">
        <div class="sources-sidebar-header">
            <h3>Sources</h3>
            <button class="sources-sidebar-close" title="Close sources">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sources-sidebar-content">
            <!-- Sources will be populated here -->
        </div>
    </div>
    
    <!-- Sources Sidebar Overlay -->
    <div id="sourcesSidebarOverlay" class="sources-sidebar-overlay"></div>

    <!-- Add the new OCR script -->
    <script src="/static/js/ocr.js"></script>
    <!-- Add the new audio transcription script -->
    <script src="/static/js/audioTranscription.js"></script>
    <!-- Add the new text-to-speech script -->
    <script src="/static/js/textToSpeech.js"></script>
    <script src="/static/js/voiceChat.js"></script>
    <!-- Add web search functionality -->
    <script src="/static/js/webSearch.js"></script>
    <!-- Add source display functionality -->
    <script src="/static/js/sourceDisplay.js"></script>
    <script src="/static/js/chat.js"></script>
    <!-- Add the RAG (Retrieval-Augmented Generation) script -->
    <script src="/static/js/rag.js"></script>
    <script src="/static/js/tabs.js"></script>
    <!-- Add the new PDF export script -->
    <script src="/static/js/pdfExport.js"></script>
    <!-- Add the new Flashcards script -->
    <script src="/static/js/flashcards.js"></script>
    <script src="/static/js/tag_system.js"></script>
    <script src="/static/js/agents.js"></script>
    <!-- Compose (editor assistant) -->
    <script src="/static/js/compose.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
