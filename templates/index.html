<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Add Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/list@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/checklist@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/quote@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/code@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@editorjs/image@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Add jsPDF for direct PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>
    
    <div class="container">
        <!-- Mobile Header with Tabs -->
        <div class="mobile-header">
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <!-- Mobile Tab Navigation -->
            <div class="mobile-tab-nav">
                <div class="tabs-container">
                    <div id="mobileTabsWrapper">
                        <div id="mobileTabsList">
                            <!-- Mobile tabs will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="mobile-tabs-toggle" id="mobileTabsToggle" title="Toggle tabs">
                <i class="fas fa-chevron-up"></i>
            </button>
        </div>
        
        <div class="sidebar" id="sidebar">
            <!-- Sidebar buttons for Notes -->
            <div id="notesButtons" class="sidebar-icons">
                <button id="createFolder" title="Create Folder"><i class="fas fa-folder-plus"></i></button>
                <button id="createNote" title="Create Note"><i class="fas fa-file-alt"></i></button>
                <!-- OCR or other note buttons can be appended here -->
            </div>
            <!-- Sidebar buttons for Chat (initially hidden) -->
            <div id="chatButtons" class="sidebar-icons" style="display:none;">
                <button id="createFolderChat" title="Create Folder"><i class="fas fa-folder-plus"></i></button>
                <button id="createChat" title="Create Chat"><i class="fas fa-comments"></i></button>
            </div>
            <!-- Sidebar buttons for Flashcards (initially hidden) -->
            <div id="flashcardsButtons" class="sidebar-icons" style="display:none;">
                <button id="createFolderFlashcards" title="Create Folder"><i class="fas fa-folder-plus"></i></button>
                <button id="createFlashcard" title="Create Flashcards"><i class="fas fa-layer-group"></i></button>
            </div>
            <!-- Create Form (shared) -->
            <div class="create-form" id="createForm" style="display: none;">
                <input type="text" id="createNameInput" placeholder="Enter name...">
                <div class="create-buttons">
                    <button id="confirmCreate"><i class="fas fa-check"></i></button>
                    <button id="cancelCreate"><i class="fas fa-times"></i></button>
                </div>
                <input type="hidden" id="createType" value="">
            </div>
            <!-- Tree containers: one for notes, one for chats, and one for flashcards -->
            <div id="noteTreeContainer" class="tree-container">
                <ul id="note-tree" class="tree">
                    <!-- Tree nodes for notes will be added here dynamically -->
                </ul>
            </div>
            <div id="chatTreeContainer" class="tree-container" style="display:none;">
                <ul id="chat-tree" class="tree">
                    <!-- Tree nodes for chats will be added here dynamically -->
                </ul>
            </div>
            <div id="flashcardsTreeContainer" class="tree-container" style="display:none;">
                <ul id="flashcards-tree" class="tree">
                    <!-- Tree nodes for flashcards will be added here dynamically -->
                </ul>
            </div>
        </div>
        <div class="content">
            <!-- Add dynamic tab navigation -->
            <div class="dynamic-tabs">
                <div class="tabs-container">
                    <div id="tabsWrapper">
                        <div id="tabsList">
                            <!-- Tabs will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Original tab navigation remains but will be hidden or shown based on active dynamic tab -->
            <div class="tab-nav">
                <button id="notesTabBtn" class="tab-btn active">Notes</button>
                <button id="chatTabBtn" class="tab-btn">Chat</button>
                <button id="flashcardsTabBtn" class="tab-btn">Flashcards</button>
            </div>
            
            <!-- Notes Section -->
            <div id="notesSection">
                <div class="note-header">
                    <h2 id="note-title-display">Select a note</h2>
                    <div class="note-actions">
                        <div class="export-pdf" id="exportPdf" title="Export as PDF">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="note-customizer" id="noteCustomizer" title="Edit background">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                    </div>
                </div>
                <div id="editorjs"></div>
            </div>
            <!-- Chat Section (initially hidden) -->
            <div id="chatSection" style="display: none;">
                <div class="chat-container">
                    <!-- Model selector dropdown in fixed position -->
                    <div class="model-selector-container chat-header-model">
                        <button id="modelSelectorBtn" class="input-btn model-btn" title="Select AI Model">
                            <i class="fas fa-robot"></i>
                            <span id="selectedModelName">llama3.2:1b</span>
                            <i class="fas fa-chevron-up"></i>
                        </button>
                        <div id="modelDropdown" class="model-dropdown">
                            <div class="dropdown-header">Available Models</div>
                            <div id="modelList" class="model-list">
                                <div class="loading-models">Loading models...</div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <!-- Chat messages will appear here -->
                    </div>
                    <div class="chat-input-area">
                        <div class="chat-input-wrapper">
                            <textarea id="chatInput" placeholder="Type your message..." rows="1"></textarea>
                            <div class="input-buttons-container">
                                <div class="input-buttons-left">
                                    <!-- Upload and voice conversation buttons will be dynamically added here -->
                                </div>
                                <div class="input-buttons-right">
                                    <button id="chatRecordBtn" class="input-btn" title="Record audio">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                    <button id="chatSendBtn" class="input-btn send-btn" title="Send message">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Hidden voice chat button for modal functionality -->
                        <button id="voiceChatBtn" style="display: none;" title="Start voice conversation">
                            <i class="fas fa-comment-dots"></i>
                        </button>
                    </div>
                </div>
            </div>
            <!-- Flashcards Section (initially hidden) -->
            <div id="flashcardsSection" style="display:none;">
                <h2>Flashcards</h2>
                <div id="flashcardsContent">
                    <!-- Dynamic flashcards content -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Gooey Menu for New Tab - Moved outside content for proper z-index -->
    <nav class="gooey-menu">
        <input type="checkbox" href="#" class="menu-open" name="menu-open" id="menu-open"/>
        <label class="menu-open-button" for="menu-open" title="Create new tab">
            <i class="fas fa-plus plus-icon"></i>
        </label>
        
        <a href="#" class="menu-item" data-type="note" title="Create Note Tab"> 
            <i class="fas fa-file-alt"></i> 
        </a>
        <a href="#" class="menu-item" data-type="chat" title="Create Chat Tab"> 
            <i class="fas fa-comments"></i> 
        </a>
        <a href="#" class="menu-item" data-type="flashcards" title="Create Flashcards Tab"> 
            <i class="fas fa-layer-group"></i> 
        </a>
    </nav>
    
    <!-- SVG filters for gooey effect -->
    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="position: absolute; width: 0; height: 0;">
        <defs>
            <filter id="shadowed-goo">
                <feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="10" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo" />
                <feGaussianBlur in="goo" stdDeviation="3" result="shadow" />
                <feColorMatrix in="shadow" mode="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 -0.2" result="shadow" />
                <feOffset in="shadow" dx="1" dy="1" result="shadow" />
                <feComposite in2="shadow" in="goo" result="goo" />
                <feComposite in2="goo" in="SourceGraphic" result="mix" />
            </filter>
            <filter id="goo">
                <feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="10" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo" />
                <feComposite in2="goo" in="SourceGraphic" result="mix" />
            </filter>
        </defs>
    </svg>
    
    <script src="/static/js/TreeView.js"></script>
    <script src="/static/js/dragDrop.js"></script>
    <script src="/static/js/editor.js"></script>
    <script src="/static/js/debug.js"></script>
    <!-- Added modal.js so that ModalManager is available -->
    <script src="/static/js/modal.js"></script>
    <!-- Add notifications utility -->
    <script src="/static/js/notifications.js"></script>
    <!-- Add mobile responsiveness -->
    <script src="/static/js/mobile.js"></script>
    <!-- Add the new OCR script -->
    <script src="/static/js/ocr.js"></script>
    <!-- Add the new audio transcription script -->
    <script src="/static/js/audioTranscription.js"></script>
    <!-- Add the new text-to-speech script -->
    <script src="/static/js/textToSpeech.js"></script>
    <script src="/static/js/voiceChat.js"></script>
    <script src="/static/js/chat.js"></script>
    <!-- Add the RAG (Retrieval-Augmented Generation) script -->
    <script src="/static/js/rag.js"></script>
    <script src="/static/js/tabs.js"></script>
    <!-- Add the new PDF export script -->
    <script src="/static/js/pdfExport.js"></script>
    <!-- Add the new Flashcards script -->
    <script src="/static/js/flashcards.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>